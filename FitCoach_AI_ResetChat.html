<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FitCoach AI</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Inter',sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);min-height:100vh;display:flex;justify-content:center;align-items:center;padding:20px}
.chat-container{width:100%;max-width:620px;height:740px;background:#fff;border-radius:22px;box-shadow:0 25px 70px rgba(0,0,0,.35);display:flex;flex-direction:column;overflow:hidden}
.chat-header{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:22px;text-align:center;position:relative}
.chat-header h1{font-size:26px;font-weight:700}
.chat-header p{font-size:14px;opacity:.9}
.reset-chat-btn{
    position:absolute;
    right:18px;
    top:18px;
    background:#ef4444;
    color:#fff;
    border:none;
    border-radius:18px;
    padding:6px 14px;
    font-size:12px;
    cursor:pointer;
}
.reset-chat-btn:hover{opacity:.9}
.config-section{background:#f9fafb;padding:16px 24px;border-bottom:1px solid #e5e7eb}
.config-section label{font-size:12px;font-weight:600;color:#6b7280}
.config-section input{width:100%;margin-top:6px;padding:11px;border-radius:10px;border:2px solid #e5e7eb;font-size:14px}
.config-section input:focus{outline:none;border-color:#667eea}
.test-button{margin-top:10px;padding:9px 18px;background:#667eea;color:#fff;border:none;border-radius:8px;cursor:pointer;font-size:13px;font-weight:600}
.status-text{margin-top:8px;font-size:12px;display:flex;align-items:center;gap:6px;color:#6b7280}
.status-indicator{width:8px;height:8px;border-radius:50%}
.connected{background:#22c55e}
.disconnected{background:#ef4444}
.chat-messages{flex:1;overflow-y:auto;padding:22px;background:#f3f4f6}
.message{display:flex;margin-bottom:16px}
.message.user{justify-content:flex-end}
.message.assistant{justify-content:flex-start}
.message-bubble{max-width:75%;padding:14px 18px;border-radius:18px;font-size:14.5px;line-height:1.7}
.message.user .message-bubble{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border-bottom-right-radius:6px}
.message.assistant .message-bubble{background:#fff;color:#1f2937;border-bottom-left-radius:6px;box-shadow:0 6px 18px rgba(0,0,0,.08)}
.chat-input-area{padding:18px;border-top:1px solid #e5e7eb}
.input-wrapper{display:flex;gap:10px}
#messageInput{flex:1;padding:12px 18px;border-radius:25px;border:2px solid #e5e7eb;font-size:14px}
#sendButton{padding:12px 26px;border-radius:25px;border:none;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;font-weight:600;cursor:pointer}
#sendButton:disabled{opacity:.5}
</style>
</head>
<body>

<div class="chat-container">

<div class="chat-header">
    <h1>ðŸ’ª FitCoach AI</h1>
    <p>Seu personal trainer virtual</p>
    <button class="reset-chat-btn" id="resetChatBtn">ðŸ—‘ Novo Chat</button>
</div>

<div class="config-section">
    <label>URL do Webhook n8n</label>
    <input id="webhookUrl">
    <button class="test-button" id="testButton">ðŸ”Œ Testar ConexÃ£o</button>
    <div class="status-text">
        <span class="status-indicator disconnected" id="statusIndicator"></span>
        <span id="statusMessage">NÃ£o conectado</span>
    </div>
</div>

<div class="chat-messages" id="chatMessages">
    <div class="message assistant">
        <div class="message-bubble">
            ðŸ‘‹ OlÃ¡! Clique em <strong>Novo Chat</strong> para comeÃ§ar ðŸ’ª
        </div>
    </div>
</div>

<div class="chat-input-area">
    <div class="input-wrapper">
        <input id="messageInput" disabled>
        <button id="sendButton" disabled>Enviar</button>
    </div>
</div>

</div>

<script>
const chatMessages=document.getElementById('chatMessages');
const messageInput=document.getElementById('messageInput');
const sendButton=document.getElementById('sendButton');
const webhookUrl=document.getElementById('webhookUrl');
const testButton=document.getElementById('testButton');
const statusIndicator=document.getElementById('statusIndicator');
const statusMessage=document.getElementById('statusMessage');
const resetChatBtn=document.getElementById('resetChatBtn');

let chatHistory=[];
let sessionId='session_'+Date.now();
let isConnected=false;

function addMessage(text,isUser){
const msg=document.createElement('div');
msg.className='message '+(isUser?'user':'assistant');
const bubble=document.createElement('div');
bubble.className='message-bubble';
bubble.innerHTML=text;
msg.appendChild(bubble);
chatMessages.appendChild(msg);
chatMessages.scrollTop=chatMessages.scrollHeight;
}

function updateStatus(ok,text){
isConnected=ok;
statusIndicator.className='status-indicator '+(ok?'connected':'disconnected');
statusMessage.textContent=text;
messageInput.disabled=!ok;
sendButton.disabled=!ok;
}

async function testConnection(){
const url=webhookUrl.value.trim();
if(!url)return;
const res=await fetch(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:'Teste',session_id:sessionId,history:[]})});
if(res.ok){
updateStatus(true,'Conectado');
}else{
updateStatus(false,'Erro');
}
}

async function sendMessage(){
const msg=messageInput.value.trim();
if(!msg)return;
addMessage(msg,true);
messageInput.value='';
const res=await fetch(webhookUrl.value,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:msg,session_id:sessionId,history:chatHistory})});
const data=await res.json();
addMessage(data.message,false);
chatHistory=data.history;
}

function resetChat(){
if(!confirm('Deseja apagar a conversa e iniciar um novo chat?'))return;
chatHistory=[];
sessionId='session_'+Date.now();
chatMessages.innerHTML=`
<div class="message assistant">
<div class="message-bubble">
âœ¨ <strong>Novo chat iniciado!</strong><br>
Qual Ã© seu objetivo de treino hoje? ðŸ’ª
</div>
</div>`;
}

resetChatBtn.onclick=resetChat;
testButton.onclick=testConnection;
sendButton.onclick=sendMessage;
messageInput.addEventListener('keypress',e=>e.key==='Enter'&&sendMessage());
</script>

</body>
</html>
